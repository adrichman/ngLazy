!function(e){"use strict";e.module("ngLazy",["ngLazy.factories","ngLazy.directives"])}(angular),angular.module("ngLazy.directives",[]).directive("lazyLoad",["$injector","$window","$document","$timeout","$rootScope",function(e,n,a,t,o){var r=function(){var e=document.createElement("style"),n="@-webkit-keyframes spin {\n	0%{-webkit-transform: rotate(0deg);}\n	100%{-webkit-transform: rotate(360deg);}\n}\n@keyframes spin{\n	0%{transform: rotate(0deg);}\n	100%{transform: rotate(360deg);}\n}";e.innerHTML=n,document.head.appendChild(e)},i=function(e,n){return e.css({WebkitBoxSizing:"border-box",boxSizing:"border-box",display:"block",width:"43px",height:"43px",margin:"20px auto",borderWidth:"8px",borderStyle:"solid",borderColor:n,borderRadius:"22px",animation:"spin 0.8s linear infinite",WebkitAnimation:"spin 0.8s linear infinite"}),e};return{restrict:"E",scope:{lazyData:"=",lazyDataCollectionKey:"@",lazyDataService:"@",lazyFetchMethod:"@",lazyRange:"@",lazyDataKeys:"=",lazyStartDelay:"@",lazyAppendDelay:"@",lazySpinnerColor:"@"},transclude:!0,template:"<div ng-transclude></div><div class='col-md-12 loading' ng-hide='spinner.hide'><div class='loading-widget'></div></div><div id='lazy-bottom'></div>",link:function(a){var l=function(e,n){return e-3*n},c=function(){return s.document.body.scrollHeight},d=angular.element(n),s=d[0],u=angular.element(document.querySelector("#lazy-bottom"))||angular.element(document.querySelector("#lazy-bottom"))[0],y=c(),g=u&&y-u.offsetTop||100,f=l(y,g),p=angular.element(document.querySelector(".loading-widget")),z=e.get("lazyLoader"),m=e.get(a.lazyDataService),h=!1,b=!0,v={};r(),p=i(p,"transparent "+a.lazySpinnerColor+" "+a.lazySpinnerColor+" "+a.lazySpinnerColor||"transparent rgb(85, 148, 250) rgb(85, 148, 250) rgb(85, 148, 250)"),a.spinner={hide:!1};var D=function(){return v.data=a.lazyData,v.collectionKey=a.lazyDataCollectionKey,v.fetchData=m[a.lazyFetchMethod],v.range=a.lazyRange,v.dataKeys=a.lazyDataKeys,v.startDelay=a.lazyStartDelay,v.appendDelay=a.lazyAppendDelay,v.spinnerColor=a.lazySpinnerColor,v},S=function(){v=D(),z.configure(v),a.$watch("spinnerColor",function(){angular.element(p.css({borderColor:"transparent "+a.lazySpinnerColor+" "+a.lazySpinnerColor+" "+a.lazySpinnerColor||"transparent rgb(85, 148, 250) rgb(85, 148, 250) rgb(85, 148, 250)"}))});var e=function(){return t(function(){console.log("waited"),S()},100)};z.load().then(function(e){h?a.lazyData[a.lazyDataCollectionKey]=e[a.lazyDataCollectionKey]:angular.forEach(Object.keys(e),function(n){a.lazyData[n]=e[n]}),b=!1},function(n){console.log(n.message),n&&e().then(function(){t.cancel(e)})})};o.$on("hideLoading",function(){a.spinner.hide=!0}),o.$on("showLoading",function(){a.spinner.hide=!1}),d.bind("scroll",function(){!b&&s.scrollY>=f&&(b=!0,s.requestAnimationFrame(function(){a.$apply(function(){S(),f=l(c(),g)})}))}),S()}}}]),angular.module("ngLazy.factories",[]).factory("lazyLoader",["$timeout","$rootScope","$q",function(e,n,a){var t,o,r,i,l,c,d,s,u={data:{}};return{configure:function(e){t=e,o=t.data,r=t.collectionKey,i=t.fetchData,l=t.dataKeys,c=t.range,d=t.appendDelay,s=t.startDelay},getData:function(){var t=a.defer();return n.$broadcast("showLoading"),u.data[r]?e(function(){o[r]=o[r].concat(u.data[r].splice(0,c)),t.resolve(o),n.$broadcast("hideLoading")},d):i().then(function(e){angular.forEach(l,function(n){u.data[n]=e.data[n],n===r?(o[n]=[],o[n]=o[n].concat(u.data[n].splice(0,c))):o[n]=u.data[n]}),t.resolve(o),n.$broadcast("hideLoading")}),t.promise},load:function(){var o=a.defer(),r=this,i=!1;if(n.$broadcast("showLoading"),angular.forEach(Object.keys(t),function(e){t[e]||(i=!0)}),i)o.reject(new Error("Bindings are not yet defined"));else{var l=e(function(){r.getData().then(function(e){o.resolve(e)})},s);l.then(function(){e.cancel(l)})}return o.promise}}}]);