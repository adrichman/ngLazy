!function(n){"use strict";n.module("ngLazy",["ngLazy.factories","ngLazy.directives"])}(angular),angular.module("ngLazy.directives",[]).directive("lazyLoad",["$injector","$window","$document","$timeout","$rootScope",function(n,a,e,t,o){var r=function(){var n=document.createElement("style"),a="@-webkit-keyframes spin {\n	0%{-webkit-transform: rotate(0deg);}\n	100%{-webkit-transform: rotate(360deg);}\n}\n@keyframes spin{\n	0%{transform: rotate(0deg);}\n	100%{transform: rotate(360deg);}\n}";n.innerHTML=a,document.head.appendChild(n)},i=function(n,a){return n.css({WebkitBoxSizing:"border-box",boxSizing:"border-box",display:"block",width:"43px",height:"43px",margin:"20px auto",borderWidth:"8px",borderStyle:"solid",borderColor:a,borderRadius:"22px",animation:"spin 0.8s linear infinite",WebkitAnimation:"spin 0.8s linear infinite"}),n};return{restrict:"E",scope:{lazyData:"=",lazyDataCollectionKey:"@",lazyDataService:"@",lazyFetchMethod:"@",lazyRange:"@",lazyDataKeys:"=",lazyStartDelay:"@",lazyAppendDelay:"@",lazySpinnerColor:"@"},transclude:!0,template:"<div ng-transclude></div><div class='col-md-12 loading' ng-hide='spinner.hide'><div class='loading-widget'></div></div><div id='lazy-bottom'></div>",link:function(e){var l=function(n,a){return n-3*a},c=function(){return s.document.body.scrollHeight},d=angular.element(a),s=d[0],u=u&&y-u.offsetTop||100,y=c(),f=y-u.offsetTop,g=l(y,f),p=angular.element(document.querySelector(".loading-widget")),z=n.get("lazyLoader"),h=n.get(e.lazyDataService),b=!1,m=!0,v={};r(),p=i(p,"transparent "+e.lazySpinnerColor+" "+e.lazySpinnerColor+" "+e.lazySpinnerColor||"transparent rgb(85, 148, 250) rgb(85, 148, 250) rgb(85, 148, 250)"),e.spinner={hide:!1};var D=function(){return v.data=e.lazyData,v.collectionKey=e.lazyDataCollectionKey,v.fetchData=h[e.lazyFetchMethod],v.range=e.lazyRange,v.dataKeys=e.lazyDataKeys,v.startDelay=e.lazyStartDelay,v.appendDelay=e.lazyAppendDelay,v.spinnerColor=e.lazySpinnerColor,v},S=function(){v=D(),z.configure(v),e.$watch("spinnerColor",function(){angular.element(p.css({borderColor:"transparent "+e.lazySpinnerColor+" "+e.lazySpinnerColor+" "+e.lazySpinnerColor||"transparent rgb(85, 148, 250) rgb(85, 148, 250) rgb(85, 148, 250)"}))});var n=function(){return t(function(){console.log("waited"),S()},100)};z.load().then(function(n){b?e.lazyData[e.lazyDataCollectionKey]=n[e.lazyDataCollectionKey]:angular.forEach(Object.keys(n),function(a){e.lazyData[a]=n[a]}),m=!1},function(a){console.log(a.message),a&&n().then(function(){t.cancel(n)})})};o.$on("hideLoading",function(){e.spinner.hide=!0}),o.$on("showLoading",function(){e.spinner.hide=!1}),d.bind("scroll",function(){!m&&s.scrollY>=g&&(m=!0,s.requestAnimationFrame(function(){e.$apply(function(){S(),g=l(c(),f)})}))}),S()}}}]),angular.module("ngLazy.factories",[]).factory("lazyLoader",["$timeout","$rootScope","$q",function(n,a,e){var t,o,r,i,l,c,d,s,u={data:{}};return{configure:function(n){t=n,o=t.data,r=t.collectionKey,i=t.fetchData,l=t.dataKeys,c=t.range,d=t.appendDelay,s=t.startDelay},getData:function(){var t=e.defer();return a.$broadcast("showLoading"),u.data[r]?n(function(){o[r]=o[r].concat(u.data[r].splice(0,c)),t.resolve(o),a.$broadcast("hideLoading")},d):i().then(function(n){angular.forEach(l,function(a){u.data[a]=n.data[a],a===r?(o[a]=[],o[a]=o[a].concat(u.data[a].splice(0,c))):o[a]=u.data[a]}),t.resolve(o),a.$broadcast("hideLoading")}),t.promise},load:function(){var o=e.defer(),r=this,i=!1;if(a.$broadcast("showLoading"),angular.forEach(Object.keys(t),function(n){t[n]||(i=!0)}),i)o.reject(new Error("Bindings are not yet defined"));else{var l=n(function(){r.getData().then(function(n){o.resolve(n)})},s);l.then(function(){n.cancel(l)})}return o.promise}}}]);