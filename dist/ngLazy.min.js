!function(a){"use strict";a.module("ngLazy",["ngLazy.factories","ngLazy.directives"])}(angular),angular.module("ngLazy.directives",[]).directive("lazyLoad",["$injector","$window","$document","$timeout","$rootScope",function(a,e,n,t,o){var r=function(){var a=document.createElement("style"),e="@-webkit-keyframes spin {\n	0%{-webkit-transform: rotate(0deg);}\n	100%{-webkit-transform: rotate(360deg);}\n}\n@keyframes spin{\n	0%{transform: rotate(0deg);}\n	100%{transform: rotate(360deg);}\n}";a.innerHTML=e,document.head.appendChild(a)},i=function(a,e){return a.css({WebkitBoxSizing:"border-box",boxSizing:"border-box",display:"block",width:"43px",height:"43px",margin:"20px auto",borderWidth:"8px",borderStyle:"solid",borderColor:e,borderRadius:"22px",animation:"spin 0.8s linear infinite",WebkitAnimation:"spin 0.8s linear infinite"}),a};return{restrict:"E",scope:{lazyData:"=",lazyDataCollectionKey:"@",lazyDataService:"@",lazyFetchMethod:"@",lazyRange:"@",lazyDataKeys:"=",lazyStartDelay:"@",lazyAppendDelay:"@",lazySpinnerColor:"@"},transclude:!0,template:"<div ng-transclude></div><div class='col-md-12 loading' ng-hide='spinner.hide'><div class='loading-widget'></div></div><div id='lazy-bottom'></div>",link:function(n){function t(a,e){return a-3*e}function l(){return c.document.body.scrollHeight}var d=angular.element(e),c=d[0],s=angular.element(document.querySelector("#lazy-bottom"))[0],y=l(),u=y-s.offsetTop,g=t(y,u),p=a.get("lazyLoader"),f=a.get(n.lazyDataService),z=angular.element(document.querySelector(".loading-widget")),m=!1,h=!1;r(),z=i(z,"transparent "+n.lazySpinnerColor+" "+n.lazySpinnerColor+" "+n.lazySpinnerColor||"transparent rgb(85, 148, 250) rgb(85, 148, 250) rgb(85, 148, 250)"),n.spinner={hide:!1};var b=function(){p.configure({data:n.lazyData,collectionKey:n.lazyDataCollectionKey,fetchData:f[n.lazyFetchMethod],range:n.lazyRange,dataKeys:n.lazyDataKeys,startDelay:n.lazyStartDelay,appendDelay:n.lazyAppendDelay,spinnerColor:n.spinnerColor}),n.$watch("spinnerColor",function(){angular.element(z.css({borderColor:"transparent "+n.lazySpinnerColor+" "+n.lazySpinnerColor+" "+n.lazySpinnerColor||"transparent rgb(85, 148, 250) rgb(85, 148, 250) rgb(85, 148, 250)"}))}),p.load().then(function(a){m?n.lazyData[n.lazyDataCollectionKey]=a[n.lazyDataCollectionKey]:angular.forEach(Object.keys(a),function(e){n.lazyData[e]=a[e]}),h=!1})};o.$on("hideLoading",function(){n.spinner.hide=!0}),o.$on("showLoading",function(){n.spinner.hide=!1}),d.bind("scroll",function(){!h&&c.scrollY>=g&&(h=!0,c.requestAnimationFrame(function(){n.$apply(function(){b(),g=t(l(),u)})}))}),b()}}}]),angular.module("ngLazy.factories",[]).factory("lazyLoader",["$timeout","$rootScope","$q",function(a,e,n){var t,o,r,i,l,d,c,s,y={data:{}};return{configure:function(a){t=a},getData:function(){o=t.data,r=t.collectionKey,i=t.fetchData,l=t.dataKeys,d=t.range,c=t.appendDelay,s=t.startDelay;var u=n.defer();return e.$broadcast("showLoading"),y.data[r]?a(function(){o[r]=o[r].concat(y.data[r].splice(0,d)),u.resolve(o),e.$broadcast("hideLoading")},c):i().then(function(a){angular.forEach(l,function(e){y.data[e]=a.data[e],e===r?(o[e]=[],o[e]=o[e].concat(y.data[e].splice(0,d))):o[e]=y.data[e]}),u.resolve(o),e.$broadcast("hideLoading")}),u.promise},load:function(){var t=n.defer(),o=this;e.$broadcast("showLoading");var r=a(function(){o.getData().then(function(a){t.resolve(a)})},s);return r.then(function(){a.cancel(r)}),t.promise}}}]);